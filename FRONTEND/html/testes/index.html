<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Lista de Voos</title>
    <style>
        .leftText {
            text-align: left;
        }
        .rightText {
            text-align: right;
        }
    </style>
</head>
<body>
    <h1>Lista de Voos</h1>

    <table border="1">
        <thead>
            <tr>
                <th class="th">Código</th>
                <th class="th">Hora de Origem</th>
                <th class="th">Data de Origem</th>
                <th class="th">Hora de Chegada</th>
                <th class="th">Data de Chegada</th>
                <th class="th">Aeroporto de Origem</th>
                <th class="th">Aeroporto de Chegada</th>
                <th class="th">ID do Trecho</th>
                <th class="th">ID da aeronave</th>
                <th class="th">Valor</th>
            </tr>
        </thead>
        <tbody id="TblVoosDados">
            <!-- A tabela será preenchida aqui -->
        </tbody>
    </table>
    <label for="idAeronave" class="textLabel">id do voo:</label>
    <input
        type="number"
        id="filtroVOO"
        placeholder=""
        class="box"
        name="idvoo"
        required
    />
    <button
        type="button"
        class="button is-link is-medium"
        onclick="inserirFiltro();"
        id="filtroVOO"
        name="filtroVOO"
    >
        Cadastrar
    </button>
    <script>
        
        function requestListaDeVoos() {
            const requestOptions = {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
            };
            return fetch('http://localhost:3000/obterVoo', requestOptions)
                .then((response) => response.json());
        }

        // Função para fazer a solicitação ao backend
        function fetchListaDeAssentos() {
            const requestOptions = {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
            };

            return fetch('http://localhost:3000/exibirAssento', requestOptions)
                .then((response) => response.json());
        }

        // Chama a função requestListaDeVoos e trata os dados recebidos
        requestListaDeVoos()
            .then((data) => {
                // 'data' contém os dados obtidos da requisição
                console.log(data);

                // Aqui você pode tratar os elementos recebidos conforme necessário
                if (data.status === 'SUCCESS') {
                // A propriedade 'payload' contém os dados da consulta
                const assentos = data.payload;

                // Exemplo de como iterar sobre os assentos
                assentos.forEach((assento) => {
                    console.log(`ID: ${assento.id_assento}, Linha: ${assento.linha}, Coluna: ${assento.coluna}`);
                    // Faça o que precisar com cada assento
                });
                } else {
                // Trate o caso em que a solicitação não foi bem-sucedida
                console.error(`Erro: ${data.message}`);
                }
            })
            .catch((error) => {
                // Trata erros de requisição ou conversão para JSON
                console.error('Erro na requisição:', error);
            });

        function preencherTabela(voos) {
            const tblBody = document.getElementById("TblVoosDados");

            voos.forEach((voo) => {
                const row = document.createElement("tr");

                row.innerHTML = `
                <td class="leftText">${voo.codigo}</td>
                <td class="leftText">${voo.hora_origem}</td>
                <td class="leftText">${voo.data_origem}</td>
                <td class="leftText">${voo.hora_chegada}</td>
                <td class="leftText">${voo.data_chegada}</td>
                <td class="leftText">${voo.aeroporto_origem}</td>
                <td class="leftText">${voo.aeroporto_chegada}</td>
                <td class="leftText">${voo.trecho_id}</td>
                <td class="leftText">${voo.aeronave_id}</td>
                <td class="rightText">${voo.valor}</td>`;

                tblBody.appendChild(row);
            });
        }

        function exibirVoos() {
            requestListaDeVoos()
                .then((customResponse) => {
                    if (customResponse.status === "SUCCESS") {
                        preencherTabela(customResponse.payload);
                    } else {
                        console.log(customResponse.message);
                    }
                })
                .catch((error) => {
                    console.error("Erro ao exibir voos:", error);
                });
        }

        document.addEventListener("DOMContentLoaded", () => {
            exibirVoos();
        });

        function fetchInserir(rota, body) {
            const requestOptions = {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body),
            };

            return fetch(rota, requestOptions).then((T) => T.json());
        }

        function inserirFiltro() {
            const filtro = document.getElementById("filtroVOO").value;

            let rota = "http://localhost:3000/Filtro";

            fetchInserir(rota, {
                codigo: filtro,
            })
                .then((data) => {
                    if (data.status === "SUCCESS") {
                        alert(data.message);
                        location.reload();
                    } else {
                        alert(data.message);
                    }
                })
                .catch((error) => {
                    alert(error.message);
                });
        }
    </script>
</body>
</html>
